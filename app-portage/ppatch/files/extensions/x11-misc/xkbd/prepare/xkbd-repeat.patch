--- a/src/xkbd.c	2017-12-16 05:50:49.232298892 +0300
+++ b/src/xkbd.c	2017-12-16 06:10:25.106497909 +0300
@@ -416,8 +416,6 @@ int main(int argc, char **argv)
        
       while (!done)
       {
-	 while ( XPending(display) ) 
-	 {
 
 	    XNextEvent(display, &an_event);
 	    xkbd_process(kb, &an_event);
@@ -440,9 +438,10 @@ int main(int argc, char **argv)
 		  xkbd_repaint(kb);
 		  break;
 	    }
-	 }
-	 xkbd_process_repeats(kb);
-	 usleep(10000L); /* sleep for a 10th of a second */
+	    while ( !XPending(display) ) {
+		xkbd_process_repeats(kb);
+		usleep(10000L); /* sleep for a 10th of a second */
+	    }
       }
       xkbd_destroy(kb);
       XCloseDisplay(display);
