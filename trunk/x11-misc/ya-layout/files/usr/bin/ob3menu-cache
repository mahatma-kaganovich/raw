#!/bin/bash
# pipe menu cache for OpenBox3
# icons changes not tracked
# param: generator command:
cmd="${*:-/usr/bin/ob3menu --slow}"
#cmd="${*:-/usr/bin/mmaker -ci OpenBox3}"

m="$HOME/.cache/ya/menu.xml"
c="/usr/share/applications $0 ${cmd%% *}"
mm=false

key(){
	echo "$cmd
$LANG"
	ls -lsR $c
}

case "$cmd" in
*ob3menu\ --slow\ *)c+=" ${3%/*}";;
*mmaker\ *)mm=echo;;
esac
{
if ! (key|cmp -s - "$m.key" && [ -s "$m" ] ); then
	mkdir -p "${m%/*}"
	{
	$mm '<openbox_pipe_menu>'
	$cmd
	$mm '</openbox_pipe_menu>'
	} >"$m"
	key >"$m.key"
fi
cat "$m"
} 2>/dev/null
